generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/activation-service-client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Activation {
  id              String           @id @default(uuid()) @db.Uuid
  organizationId  String           @map("organization_id") @db.Uuid
  brandId         String           @map("brand_id") @db.Uuid
  contentId       String           @map("content_id") @db.Uuid
  campaignId      String?          @map("campaign_id") @db.Uuid
  name            String
  slug            String
  description     String?
  type            ActivationType   @default(EMBED)
  status          ActivationStatus @default(DRAFT)
  config          Json?
  targeting       Json?
  startDate       DateTime?        @map("start_date")
  endDate         DateTime?        @map("end_date")
  createdBy       String           @map("created_by") @db.Uuid
  createdAt       DateTime         @default(now()) @map("created_at")
  updatedAt       DateTime         @updatedAt @map("updated_at")

  embedCodes      EmbedCode[]
  analytics       ActivationAnalytics[]
  events          ActivationEvent[]
  allowedDomains  AllowedDomain[]

  @@unique([organizationId, slug])
  @@index([organizationId])
  @@index([brandId])
  @@index([contentId])
  @@index([campaignId])
  @@index([status])
  @@index([createdBy])
  @@map("activations")
}

model EmbedCode {
  id              String    @id @default(uuid()) @db.Uuid
  activationId    String    @map("activation_id") @db.Uuid
  type            EmbedType @default(SCRIPT)
  code            String
  hash            String    @unique
  isActive        Boolean   @default(true) @map("is_active")
  expiresAt       DateTime? @map("expires_at")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  activation Activation @relation(fields: [activationId], references: [id], onDelete: Cascade)

  @@index([activationId])
  @@index([hash])
  @@map("embed_codes")
}

model ActivationAnalytics {
  id              String   @id @default(uuid()) @db.Uuid
  activationId    String   @map("activation_id") @db.Uuid
  date            DateTime @db.Date
  views           Int      @default(0)
  uniqueViews     Int      @default(0) @map("unique_views")
  engagements     Int      @default(0)
  clicks          Int      @default(0)
  conversions     Int      @default(0)
  avgWatchTime    Float?   @map("avg_watch_time")
  bounceRate      Float?   @map("bounce_rate")
  metadata        Json?
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  activation Activation @relation(fields: [activationId], references: [id], onDelete: Cascade)

  @@unique([activationId, date])
  @@index([activationId])
  @@index([date])
  @@map("activation_analytics")
}

model ActivationEvent {
  id              String   @id @default(uuid()) @db.Uuid
  activationId    String   @map("activation_id") @db.Uuid
  eventType       String   @map("event_type")
  visitorId       String?  @map("visitor_id")
  sessionId       String?  @map("session_id")
  referrer        String?
  userAgent       String?  @map("user_agent")
  ipAddress       String?  @map("ip_address")
  country         String?
  device          String?
  browser         String?
  metadata        Json?
  createdAt       DateTime @default(now()) @map("created_at")

  activation Activation @relation(fields: [activationId], references: [id], onDelete: Cascade)

  @@index([activationId])
  @@index([eventType])
  @@index([createdAt])
  @@index([visitorId])
  @@map("activation_events")
}

model AllowedDomain {
  id              String   @id @default(uuid()) @db.Uuid
  activationId    String   @map("activation_id") @db.Uuid
  domain          String
  isActive        Boolean  @default(true) @map("is_active")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  activation Activation @relation(fields: [activationId], references: [id], onDelete: Cascade)

  @@unique([activationId, domain])
  @@index([activationId])
  @@index([domain])
  @@map("allowed_domains")
}

enum ActivationType {
  EMBED
  POPUP
  INLINE
  FLOATING
  LIGHTBOX
  CAROUSEL
  GRID
  WIDGET
}

enum ActivationStatus {
  DRAFT
  PENDING_REVIEW
  ACTIVE
  PAUSED
  EXPIRED
  ARCHIVED
}

enum EmbedType {
  SCRIPT
  IFRAME
  DIRECT_URL
  REACT_COMPONENT
  VUE_COMPONENT
  WEB_COMPONENT
}
