generator client {
  output   = "../node_modules/.prisma/client"
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Notification {
  id          String   @id @default(uuid()) @db.Uuid
  userId      String?  @map("user_id") @db.Uuid
  type        NotificationType
  channel     NotificationChannel[]
  priority    NotificationPriority @default(NORMAL)
  subject     String?
  template    String?
  data        Json?
  status      NotificationStatus @default(PENDING)
  scheduledFor DateTime? @map("scheduled_for")
  sentAt      DateTime? @map("sent_at")
  failedAt    DateTime? @map("failed_at")
  error       String?
  retryCount  Int      @default(0) @map("retry_count")
  metadata    Json?
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  logs        NotificationLog[]

  @@index([userId])
  @@index([status])
  @@index([scheduledFor])
  @@index([createdAt])
  @@map("notifications")
}

model NotificationLog {
  id              String   @id @default(uuid()) @db.Uuid
  notificationId  String   @map("notification_id") @db.Uuid
  channel         NotificationChannel
  status          String
  provider        String?
  providerId      String?  @map("provider_id")
  response        Json?
  error           String?
  sentAt          DateTime? @map("sent_at")
  deliveredAt     DateTime? @map("delivered_at")
  openedAt        DateTime? @map("opened_at")
  clickedAt       DateTime? @map("clicked_at")
  metadata        Json?
  createdAt       DateTime @default(now()) @map("created_at")

  notification    Notification @relation(fields: [notificationId], references: [id], onDelete: Cascade)

  @@index([notificationId])
  @@index([channel])
  @@index([status])
  @@index([createdAt])
  @@map("notification_logs")
}

model NotificationPreference {
  id        String   @id @default(uuid()) @db.Uuid
  userId    String   @map("user_id") @db.Uuid
  type      NotificationType
  email     Boolean  @default(true)
  sms       Boolean  @default(false)
  push      Boolean  @default(true)
  slack     Boolean  @default(false)
  webhook   Boolean  @default(false)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@unique([userId, type])
  @@index([userId])
  @@map("notification_preferences")
}

model NotificationTemplate {
  id          String   @id @default(uuid()) @db.Uuid
  name        String   @unique
  type        NotificationType
  channel     NotificationChannel
  subject     String?
  body        String
  variables   String[]
  isActive    Boolean  @default(true) @map("is_active")
  metadata    Json?
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@index([type])
  @@index([channel])
  @@map("notification_templates")
}

enum NotificationType {
  WELCOME
  EMAIL_VERIFICATION
  PASSWORD_RESET
  CAMPAIGN_CREATED
  CAMPAIGN_UPDATED
  CAMPAIGN_COMPLETED
  CONTENT_UPLOADED
  CONTENT_APPROVED
  CONTENT_REJECTED
  PAYMENT_RECEIVED
  PAYMENT_FAILED
  SUBSCRIPTION_CREATED
  SUBSCRIPTION_RENEWED
  SUBSCRIPTION_CANCELLED
  CREATOR_APPLICATION
  CREATOR_APPROVED
  CREATOR_REJECTED
  MESSAGE_RECEIVED
  TASK_ASSIGNED
  TASK_COMPLETED
  REVIEW_REQUESTED
  REVIEW_RECEIVED
  SYSTEM_ALERT
  CUSTOM
}

enum NotificationChannel {
  EMAIL
  SMS
  PUSH
  SLACK
  WEBHOOK
}

enum NotificationPriority {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum NotificationStatus {
  PENDING
  SCHEDULED
  SENDING
  SENT
  DELIVERED
  FAILED
  CANCELLED
}
