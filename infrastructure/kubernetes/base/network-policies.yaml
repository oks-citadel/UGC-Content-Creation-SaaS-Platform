# Network Policies for CreatorBridge UGC Platform
# These policies implement a zero-trust network model where:
# - Only api-gateway accepts external traffic
# - Internal services only accept traffic from api-gateway and other allowed services
# - All services can call auth-service for authentication
# - Egress is allowed to PostgreSQL, Redis, and Azure services

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: default-deny-all
  namespace: nexus
  labels:
    app.kubernetes.io/part-of: nexus-platform
spec:
  podSelector: {}
  policyTypes:
    - Ingress
    - Egress

---
# API Gateway - Accepts external traffic and can communicate with all backend services
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: api-gateway-network-policy
  namespace: nexus
  labels:
    app.kubernetes.io/name: api-gateway
    app.kubernetes.io/part-of: nexus-platform
spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/name: api-gateway
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: ingress-nginx
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: kube-system
      ports:
        - protocol: TCP
          port: 8080
        - protocol: TCP
          port: 3000
    - from:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: monitoring
      ports:
        - protocol: TCP
          port: 9090
  egress:
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/part-of: nexus-platform
      ports:
        - protocol: TCP
          port: 80
        - protocol: TCP
          port: 3001
        - protocol: TCP
          port: 3002
        - protocol: TCP
          port: 3003
        - protocol: TCP
          port: 3004
        - protocol: TCP
          port: 3005
        - protocol: TCP
          port: 3006
        - protocol: TCP
          port: 3007
        - protocol: TCP
          port: 3008
        - protocol: TCP
          port: 3009
        - protocol: TCP
          port: 3010
        - protocol: TCP
          port: 3011
        - protocol: TCP
          port: 3012
    - to:
        - namespaceSelector: {}
          podSelector:
            matchLabels:
              k8s-app: kube-dns
      ports:
        - protocol: UDP
          port: 53
        - protocol: TCP
          port: 53
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: redis
      ports:
        - protocol: TCP
          port: 6379
    - to:
        - ipBlock:
            cidr: 0.0.0.0/0
            except:
              - 10.0.0.0/8
              - 172.16.0.0/12
              - 192.168.0.0/16
      ports:
        - protocol: TCP
          port: 443

---
# Auth Service - Can be called by all services
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: auth-service-network-policy
  namespace: nexus
  labels:
    app.kubernetes.io/name: auth-service
    app.kubernetes.io/part-of: nexus-platform
spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/name: auth-service
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app.kubernetes.io/part-of: nexus-platform
      ports:
        - protocol: TCP
          port: 8081
        - protocol: TCP
          port: 3001
        - protocol: TCP
          port: 80
    - from:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: monitoring
      ports:
        - protocol: TCP
          port: 9090
  egress:
    - to:
        - namespaceSelector: {}
          podSelector:
            matchLabels:
              k8s-app: kube-dns
      ports:
        - protocol: UDP
          port: 53
        - protocol: TCP
          port: 53
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: postgresql
      ports:
        - protocol: TCP
          port: 5432
    - to:
        - ipBlock:
            cidr: 0.0.0.0/0
            except:
              - 10.0.0.0/8
              - 172.16.0.0/12
              - 192.168.0.0/16
      ports:
        - protocol: TCP
          port: 5432
        - protocol: TCP
          port: 443
        - protocol: TCP
          port: 6380
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: redis
      ports:
        - protocol: TCP
          port: 6379

---
# User Service
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: user-service-network-policy
  namespace: nexus
  labels:
    app.kubernetes.io/name: user-service
    app.kubernetes.io/part-of: nexus-platform
spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/name: user-service
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: api-gateway
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: billing-service
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: notification-service
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: campaign-service
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: creator-service
      ports:
        - protocol: TCP
          port: 8082
        - protocol: TCP
          port: 3002
        - protocol: TCP
          port: 80
    - from:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: monitoring
      ports:
        - protocol: TCP
          port: 9090
  egress:
    - to:
        - namespaceSelector: {}
          podSelector:
            matchLabels:
              k8s-app: kube-dns
      ports:
        - protocol: UDP
          port: 53
        - protocol: TCP
          port: 53
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: auth-service
      ports:
        - protocol: TCP
          port: 8081
        - protocol: TCP
          port: 3001
        - protocol: TCP
          port: 80
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: postgresql
      ports:
        - protocol: TCP
          port: 5432
    - to:
        - ipBlock:
            cidr: 0.0.0.0/0
            except:
              - 10.0.0.0/8
              - 172.16.0.0/12
              - 192.168.0.0/16
      ports:
        - protocol: TCP
          port: 5432
        - protocol: TCP
          port: 443
        - protocol: TCP
          port: 6380
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: redis
      ports:
        - protocol: TCP
          port: 6379

---
# Billing Service
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: billing-service-network-policy
  namespace: nexus
  labels:
    app.kubernetes.io/name: billing-service
    app.kubernetes.io/part-of: nexus-platform
spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/name: billing-service
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: api-gateway
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: commerce-service
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: payout-service
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: marketplace-service
      ports:
        - protocol: TCP
          port: 8083
        - protocol: TCP
          port: 3008
        - protocol: TCP
          port: 80
    - from:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: monitoring
      ports:
        - protocol: TCP
          port: 9090
  egress:
    - to:
        - namespaceSelector: {}
          podSelector:
            matchLabels:
              k8s-app: kube-dns
      ports:
        - protocol: UDP
          port: 53
        - protocol: TCP
          port: 53
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: auth-service
      ports:
        - protocol: TCP
          port: 8081
        - protocol: TCP
          port: 3001
        - protocol: TCP
          port: 80
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: user-service
      ports:
        - protocol: TCP
          port: 8082
        - protocol: TCP
          port: 3002
        - protocol: TCP
          port: 80
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: postgresql
      ports:
        - protocol: TCP
          port: 5432
    - to:
        - ipBlock:
            cidr: 0.0.0.0/0
            except:
              - 10.0.0.0/8
              - 172.16.0.0/12
              - 192.168.0.0/16
      ports:
        - protocol: TCP
          port: 5432
        - protocol: TCP
          port: 443
        - protocol: TCP
          port: 6380
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: redis
      ports:
        - protocol: TCP
          port: 6379

---
# Notification Service - accepts from all platform services
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: notification-service-network-policy
  namespace: nexus
  labels:
    app.kubernetes.io/name: notification-service
    app.kubernetes.io/part-of: nexus-platform
spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/name: notification-service
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app.kubernetes.io/part-of: nexus-platform
      ports:
        - protocol: TCP
          port: 8084
        - protocol: TCP
          port: 3004
        - protocol: TCP
          port: 80
    - from:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: monitoring
      ports:
        - protocol: TCP
          port: 9090
  egress:
    - to:
        - namespaceSelector: {}
          podSelector:
            matchLabels:
              k8s-app: kube-dns
      ports:
        - protocol: UDP
          port: 53
        - protocol: TCP
          port: 53
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: auth-service
      ports:
        - protocol: TCP
          port: 8081
        - protocol: TCP
          port: 3001
        - protocol: TCP
          port: 80
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: user-service
      ports:
        - protocol: TCP
          port: 8082
        - protocol: TCP
          port: 3002
        - protocol: TCP
          port: 80
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: postgresql
      ports:
        - protocol: TCP
          port: 5432
    - to:
        - ipBlock:
            cidr: 0.0.0.0/0
            except:
              - 10.0.0.0/8
              - 172.16.0.0/12
              - 192.168.0.0/16
      ports:
        - protocol: TCP
          port: 5432
        - protocol: TCP
          port: 443
        - protocol: TCP
          port: 587
        - protocol: TCP
          port: 465
        - protocol: TCP
          port: 6380
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: redis
      ports:
        - protocol: TCP
          port: 6379

---
# Campaign Service
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: campaign-service-network-policy
  namespace: nexus
  labels:
    app.kubernetes.io/name: campaign-service
    app.kubernetes.io/part-of: nexus-platform
spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/name: campaign-service
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: api-gateway
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: workflow-service
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: analytics-service
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: content-service
      ports:
        - protocol: TCP
          port: 8085
        - protocol: TCP
          port: 3005
        - protocol: TCP
          port: 80
    - from:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: monitoring
      ports:
        - protocol: TCP
          port: 9090
  egress:
    - to:
        - namespaceSelector: {}
          podSelector:
            matchLabels:
              k8s-app: kube-dns
      ports:
        - protocol: UDP
          port: 53
        - protocol: TCP
          port: 53
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: auth-service
      ports:
        - protocol: TCP
          port: 8081
        - protocol: TCP
          port: 3001
        - protocol: TCP
          port: 80
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: user-service
      ports:
        - protocol: TCP
          port: 8082
        - protocol: TCP
          port: 3002
        - protocol: TCP
          port: 80
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: creator-service
      ports:
        - protocol: TCP
          port: 8086
        - protocol: TCP
          port: 3003
        - protocol: TCP
          port: 80
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: content-service
      ports:
        - protocol: TCP
          port: 8087
        - protocol: TCP
          port: 3006
        - protocol: TCP
          port: 80
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: notification-service
      ports:
        - protocol: TCP
          port: 8084
        - protocol: TCP
          port: 3004
        - protocol: TCP
          port: 80
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: postgresql
      ports:
        - protocol: TCP
          port: 5432
    - to:
        - ipBlock:
            cidr: 0.0.0.0/0
            except:
              - 10.0.0.0/8
              - 172.16.0.0/12
              - 192.168.0.0/16
      ports:
        - protocol: TCP
          port: 5432
        - protocol: TCP
          port: 443
        - protocol: TCP
          port: 6380
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: redis
      ports:
        - protocol: TCP
          port: 6379

---
# Creator Service
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: creator-service-network-policy
  namespace: nexus
  labels:
    app.kubernetes.io/name: creator-service
    app.kubernetes.io/part-of: nexus-platform
spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/name: creator-service
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: api-gateway
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: campaign-service
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: marketplace-service
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: payout-service
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: content-service
      ports:
        - protocol: TCP
          port: 8086
        - protocol: TCP
          port: 3003
        - protocol: TCP
          port: 80
    - from:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: monitoring
      ports:
        - protocol: TCP
          port: 9090
  egress:
    - to:
        - namespaceSelector: {}
          podSelector:
            matchLabels:
              k8s-app: kube-dns
      ports:
        - protocol: UDP
          port: 53
        - protocol: TCP
          port: 53
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: auth-service
      ports:
        - protocol: TCP
          port: 8081
        - protocol: TCP
          port: 3001
        - protocol: TCP
          port: 80
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: user-service
      ports:
        - protocol: TCP
          port: 8082
        - protocol: TCP
          port: 3002
        - protocol: TCP
          port: 80
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: postgresql
      ports:
        - protocol: TCP
          port: 5432
    - to:
        - ipBlock:
            cidr: 0.0.0.0/0
            except:
              - 10.0.0.0/8
              - 172.16.0.0/12
              - 192.168.0.0/16
      ports:
        - protocol: TCP
          port: 5432
        - protocol: TCP
          port: 443
        - protocol: TCP
          port: 6380
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: redis
      ports:
        - protocol: TCP
          port: 6379

---
# Content Service
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: content-service-network-policy
  namespace: nexus
  labels:
    app.kubernetes.io/name: content-service
    app.kubernetes.io/part-of: nexus-platform
spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/name: content-service
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: api-gateway
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: campaign-service
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: asset-service
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: rights-service
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: workflow-service
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: ai-service
      ports:
        - protocol: TCP
          port: 8087
        - protocol: TCP
          port: 3006
        - protocol: TCP
          port: 80
    - from:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: monitoring
      ports:
        - protocol: TCP
          port: 9090
  egress:
    - to:
        - namespaceSelector: {}
          podSelector:
            matchLabels:
              k8s-app: kube-dns
      ports:
        - protocol: UDP
          port: 53
        - protocol: TCP
          port: 53
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: auth-service
      ports:
        - protocol: TCP
          port: 8081
        - protocol: TCP
          port: 3001
        - protocol: TCP
          port: 80
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: asset-service
      ports:
        - protocol: TCP
          port: 8088
        - protocol: TCP
          port: 80
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: creator-service
      ports:
        - protocol: TCP
          port: 8086
        - protocol: TCP
          port: 3003
        - protocol: TCP
          port: 80
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: rights-service
      ports:
        - protocol: TCP
          port: 8089
        - protocol: TCP
          port: 80
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: campaign-service
      ports:
        - protocol: TCP
          port: 8085
        - protocol: TCP
          port: 3005
        - protocol: TCP
          port: 80
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: postgresql
      ports:
        - protocol: TCP
          port: 5432
    - to:
        - ipBlock:
            cidr: 0.0.0.0/0
            except:
              - 10.0.0.0/8
              - 172.16.0.0/12
              - 192.168.0.0/16
      ports:
        - protocol: TCP
          port: 5432
        - protocol: TCP
          port: 443
        - protocol: TCP
          port: 6380
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: redis
      ports:
        - protocol: TCP
          port: 6379

---
# Asset Service
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: asset-service-network-policy
  namespace: nexus
  labels:
    app.kubernetes.io/name: asset-service
    app.kubernetes.io/part-of: nexus-platform
spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/name: asset-service
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: api-gateway
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: content-service
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: campaign-service
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: workflow-service
      ports:
        - protocol: TCP
          port: 8088
        - protocol: TCP
          port: 80
    - from:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: monitoring
      ports:
        - protocol: TCP
          port: 9090
  egress:
    - to:
        - namespaceSelector: {}
          podSelector:
            matchLabels:
              k8s-app: kube-dns
      ports:
        - protocol: UDP
          port: 53
        - protocol: TCP
          port: 53
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: auth-service
      ports:
        - protocol: TCP
          port: 8081
        - protocol: TCP
          port: 3001
        - protocol: TCP
          port: 80
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: postgresql
      ports:
        - protocol: TCP
          port: 5432
    - to:
        - ipBlock:
            cidr: 0.0.0.0/0
            except:
              - 10.0.0.0/8
              - 172.16.0.0/12
              - 192.168.0.0/16
      ports:
        - protocol: TCP
          port: 5432
        - protocol: TCP
          port: 443
        - protocol: TCP
          port: 6380
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: redis
      ports:
        - protocol: TCP
          port: 6379

---
# Rights Service
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: rights-service-network-policy
  namespace: nexus
  labels:
    app.kubernetes.io/name: rights-service
    app.kubernetes.io/part-of: nexus-platform
spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/name: rights-service
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: api-gateway
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: content-service
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: compliance-service
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: marketplace-service
      ports:
        - protocol: TCP
          port: 8089
        - protocol: TCP
          port: 80
    - from:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: monitoring
      ports:
        - protocol: TCP
          port: 9090
  egress:
    - to:
        - namespaceSelector: {}
          podSelector:
            matchLabels:
              k8s-app: kube-dns
      ports:
        - protocol: UDP
          port: 53
        - protocol: TCP
          port: 53
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: auth-service
      ports:
        - protocol: TCP
          port: 8081
        - protocol: TCP
          port: 3001
        - protocol: TCP
          port: 80
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: content-service
      ports:
        - protocol: TCP
          port: 8087
        - protocol: TCP
          port: 3006
        - protocol: TCP
          port: 80
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: postgresql
      ports:
        - protocol: TCP
          port: 5432
    - to:
        - ipBlock:
            cidr: 0.0.0.0/0
            except:
              - 10.0.0.0/8
              - 172.16.0.0/12
              - 192.168.0.0/16
      ports:
        - protocol: TCP
          port: 5432
        - protocol: TCP
          port: 443
        - protocol: TCP
          port: 6380
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: redis
      ports:
        - protocol: TCP
          port: 6379

---
# Analytics Service
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: analytics-service-network-policy
  namespace: nexus
  labels:
    app.kubernetes.io/name: analytics-service
    app.kubernetes.io/part-of: nexus-platform
spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/name: analytics-service
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: api-gateway
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: campaign-service
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: content-service
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: commerce-service
      ports:
        - protocol: TCP
          port: 8090
        - protocol: TCP
          port: 3007
        - protocol: TCP
          port: 80
    - from:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: monitoring
      ports:
        - protocol: TCP
          port: 9090
  egress:
    - to:
        - namespaceSelector: {}
          podSelector:
            matchLabels:
              k8s-app: kube-dns
      ports:
        - protocol: UDP
          port: 53
        - protocol: TCP
          port: 53
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: auth-service
      ports:
        - protocol: TCP
          port: 8081
        - protocol: TCP
          port: 3001
        - protocol: TCP
          port: 80
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: campaign-service
      ports:
        - protocol: TCP
          port: 8085
        - protocol: TCP
          port: 3005
        - protocol: TCP
          port: 80
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: postgresql
      ports:
        - protocol: TCP
          port: 5432
    - to:
        - ipBlock:
            cidr: 0.0.0.0/0
            except:
              - 10.0.0.0/8
              - 172.16.0.0/12
              - 192.168.0.0/16
      ports:
        - protocol: TCP
          port: 5432
        - protocol: TCP
          port: 443
        - protocol: TCP
          port: 6380
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: redis
      ports:
        - protocol: TCP
          port: 6379

---
# Payout Service
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: payout-service-network-policy
  namespace: nexus
  labels:
    app.kubernetes.io/name: payout-service
    app.kubernetes.io/part-of: nexus-platform
spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/name: payout-service
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: api-gateway
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: billing-service
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: commerce-service
      ports:
        - protocol: TCP
          port: 8091
        - protocol: TCP
          port: 80
    - from:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: monitoring
      ports:
        - protocol: TCP
          port: 9090
  egress:
    - to:
        - namespaceSelector: {}
          podSelector:
            matchLabels:
              k8s-app: kube-dns
      ports:
        - protocol: UDP
          port: 53
        - protocol: TCP
          port: 53
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: auth-service
      ports:
        - protocol: TCP
          port: 8081
        - protocol: TCP
          port: 3001
        - protocol: TCP
          port: 80
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: creator-service
      ports:
        - protocol: TCP
          port: 8086
        - protocol: TCP
          port: 3003
        - protocol: TCP
          port: 80
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: billing-service
      ports:
        - protocol: TCP
          port: 8083
        - protocol: TCP
          port: 3008
        - protocol: TCP
          port: 80
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: notification-service
      ports:
        - protocol: TCP
          port: 8084
        - protocol: TCP
          port: 3004
        - protocol: TCP
          port: 80
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: postgresql
      ports:
        - protocol: TCP
          port: 5432
    - to:
        - ipBlock:
            cidr: 0.0.0.0/0
            except:
              - 10.0.0.0/8
              - 172.16.0.0/12
              - 192.168.0.0/16
      ports:
        - protocol: TCP
          port: 5432
        - protocol: TCP
          port: 443
        - protocol: TCP
          port: 6380
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: redis
      ports:
        - protocol: TCP
          port: 6379

---
# Marketplace Service
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: marketplace-service-network-policy
  namespace: nexus
  labels:
    app.kubernetes.io/name: marketplace-service
    app.kubernetes.io/part-of: nexus-platform
spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/name: marketplace-service
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: api-gateway
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: commerce-service
      ports:
        - protocol: TCP
          port: 8092
        - protocol: TCP
          port: 3009
        - protocol: TCP
          port: 80
    - from:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: monitoring
      ports:
        - protocol: TCP
          port: 9090
  egress:
    - to:
        - namespaceSelector: {}
          podSelector:
            matchLabels:
              k8s-app: kube-dns
      ports:
        - protocol: UDP
          port: 53
        - protocol: TCP
          port: 53
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: auth-service
      ports:
        - protocol: TCP
          port: 8081
        - protocol: TCP
          port: 3001
        - protocol: TCP
          port: 80
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: creator-service
      ports:
        - protocol: TCP
          port: 8086
        - protocol: TCP
          port: 3003
        - protocol: TCP
          port: 80
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: billing-service
      ports:
        - protocol: TCP
          port: 8083
        - protocol: TCP
          port: 3008
        - protocol: TCP
          port: 80
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: rights-service
      ports:
        - protocol: TCP
          port: 8089
        - protocol: TCP
          port: 80
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: postgresql
      ports:
        - protocol: TCP
          port: 5432
    - to:
        - ipBlock:
            cidr: 0.0.0.0/0
            except:
              - 10.0.0.0/8
              - 172.16.0.0/12
              - 192.168.0.0/16
      ports:
        - protocol: TCP
          port: 5432
        - protocol: TCP
          port: 443
        - protocol: TCP
          port: 6380
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: redis
      ports:
        - protocol: TCP
          port: 6379

---
# Commerce Service
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: commerce-service-network-policy
  namespace: nexus
  labels:
    app.kubernetes.io/name: commerce-service
    app.kubernetes.io/part-of: nexus-platform
spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/name: commerce-service
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: api-gateway
      ports:
        - protocol: TCP
          port: 8093
        - protocol: TCP
          port: 3010
        - protocol: TCP
          port: 80
    - from:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: monitoring
      ports:
        - protocol: TCP
          port: 9090
  egress:
    - to:
        - namespaceSelector: {}
          podSelector:
            matchLabels:
              k8s-app: kube-dns
      ports:
        - protocol: UDP
          port: 53
        - protocol: TCP
          port: 53
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: auth-service
      ports:
        - protocol: TCP
          port: 8081
        - protocol: TCP
          port: 3001
        - protocol: TCP
          port: 80
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: billing-service
      ports:
        - protocol: TCP
          port: 8083
        - protocol: TCP
          port: 3008
        - protocol: TCP
          port: 80
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: marketplace-service
      ports:
        - protocol: TCP
          port: 8092
        - protocol: TCP
          port: 3009
        - protocol: TCP
          port: 80
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: payout-service
      ports:
        - protocol: TCP
          port: 8091
        - protocol: TCP
          port: 80
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: analytics-service
      ports:
        - protocol: TCP
          port: 8090
        - protocol: TCP
          port: 3007
        - protocol: TCP
          port: 80
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: postgresql
      ports:
        - protocol: TCP
          port: 5432
    - to:
        - ipBlock:
            cidr: 0.0.0.0/0
            except:
              - 10.0.0.0/8
              - 172.16.0.0/12
              - 192.168.0.0/16
      ports:
        - protocol: TCP
          port: 5432
        - protocol: TCP
          port: 443
        - protocol: TCP
          port: 6380
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: redis
      ports:
        - protocol: TCP
          port: 6379

---
# Compliance Service
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: compliance-service-network-policy
  namespace: nexus
  labels:
    app.kubernetes.io/name: compliance-service
    app.kubernetes.io/part-of: nexus-platform
spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/name: compliance-service
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: api-gateway
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: content-service
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: rights-service
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: workflow-service
      ports:
        - protocol: TCP
          port: 8094
        - protocol: TCP
          port: 80
    - from:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: monitoring
      ports:
        - protocol: TCP
          port: 9090
  egress:
    - to:
        - namespaceSelector: {}
          podSelector:
            matchLabels:
              k8s-app: kube-dns
      ports:
        - protocol: UDP
          port: 53
        - protocol: TCP
          port: 53
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: auth-service
      ports:
        - protocol: TCP
          port: 8081
        - protocol: TCP
          port: 3001
        - protocol: TCP
          port: 80
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: rights-service
      ports:
        - protocol: TCP
          port: 8089
        - protocol: TCP
          port: 80
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: content-service
      ports:
        - protocol: TCP
          port: 8087
        - protocol: TCP
          port: 3006
        - protocol: TCP
          port: 80
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: postgresql
      ports:
        - protocol: TCP
          port: 5432
    - to:
        - ipBlock:
            cidr: 0.0.0.0/0
            except:
              - 10.0.0.0/8
              - 172.16.0.0/12
              - 192.168.0.0/16
      ports:
        - protocol: TCP
          port: 5432
        - protocol: TCP
          port: 443
        - protocol: TCP
          port: 6380
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: redis
      ports:
        - protocol: TCP
          port: 6379

---
# Integration Service
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: integration-service-network-policy
  namespace: nexus
  labels:
    app.kubernetes.io/name: integration-service
    app.kubernetes.io/part-of: nexus-platform
spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/name: integration-service
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: api-gateway
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: workflow-service
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: campaign-service
      ports:
        - protocol: TCP
          port: 8095
        - protocol: TCP
          port: 80
    - from:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: monitoring
      ports:
        - protocol: TCP
          port: 9090
  egress:
    - to:
        - namespaceSelector: {}
          podSelector:
            matchLabels:
              k8s-app: kube-dns
      ports:
        - protocol: UDP
          port: 53
        - protocol: TCP
          port: 53
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: auth-service
      ports:
        - protocol: TCP
          port: 8081
        - protocol: TCP
          port: 3001
        - protocol: TCP
          port: 80
    - to:
        - ipBlock:
            cidr: 0.0.0.0/0
            except:
              - 10.0.0.0/8
              - 172.16.0.0/12
              - 192.168.0.0/16
      ports:
        - protocol: TCP
          port: 443
        - protocol: TCP
          port: 80
        - protocol: TCP
          port: 5432
        - protocol: TCP
          port: 6380
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: postgresql
      ports:
        - protocol: TCP
          port: 5432
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: redis
      ports:
        - protocol: TCP
          port: 6379

---
# Workflow Service
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: workflow-service-network-policy
  namespace: nexus
  labels:
    app.kubernetes.io/name: workflow-service
    app.kubernetes.io/part-of: nexus-platform
spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/name: workflow-service
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: api-gateway
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: campaign-service
      ports:
        - protocol: TCP
          port: 8096
        - protocol: TCP
          port: 3011
        - protocol: TCP
          port: 80
    - from:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: monitoring
      ports:
        - protocol: TCP
          port: 9090
  egress:
    - to:
        - namespaceSelector: {}
          podSelector:
            matchLabels:
              k8s-app: kube-dns
      ports:
        - protocol: UDP
          port: 53
        - protocol: TCP
          port: 53
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: auth-service
      ports:
        - protocol: TCP
          port: 8081
        - protocol: TCP
          port: 3001
        - protocol: TCP
          port: 80
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: campaign-service
      ports:
        - protocol: TCP
          port: 8085
        - protocol: TCP
          port: 3005
        - protocol: TCP
          port: 80
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: content-service
      ports:
        - protocol: TCP
          port: 8087
        - protocol: TCP
          port: 3006
        - protocol: TCP
          port: 80
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: asset-service
      ports:
        - protocol: TCP
          port: 8088
        - protocol: TCP
          port: 80
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: notification-service
      ports:
        - protocol: TCP
          port: 8084
        - protocol: TCP
          port: 3004
        - protocol: TCP
          port: 80
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: integration-service
      ports:
        - protocol: TCP
          port: 8095
        - protocol: TCP
          port: 80
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: compliance-service
      ports:
        - protocol: TCP
          port: 8094
        - protocol: TCP
          port: 80
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: postgresql
      ports:
        - protocol: TCP
          port: 5432
    - to:
        - ipBlock:
            cidr: 0.0.0.0/0
            except:
              - 10.0.0.0/8
              - 172.16.0.0/12
              - 192.168.0.0/16
      ports:
        - protocol: TCP
          port: 5432
        - protocol: TCP
          port: 443
        - protocol: TCP
          port: 6380
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: redis
      ports:
        - protocol: TCP
          port: 6379

---
# AI Service
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: ai-service-network-policy
  namespace: nexus
  labels:
    app.kubernetes.io/name: ai-service
    app.kubernetes.io/part-of: nexus-platform
spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/name: ai-service
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: api-gateway
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: content-service
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: campaign-service
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: analytics-service
      ports:
        - protocol: TCP
          port: 3012
        - protocol: TCP
          port: 80
    - from:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: monitoring
      ports:
        - protocol: TCP
          port: 9090
  egress:
    - to:
        - namespaceSelector: {}
          podSelector:
            matchLabels:
              k8s-app: kube-dns
      ports:
        - protocol: UDP
          port: 53
        - protocol: TCP
          port: 53
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: auth-service
      ports:
        - protocol: TCP
          port: 8081
        - protocol: TCP
          port: 3001
        - protocol: TCP
          port: 80
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: content-service
      ports:
        - protocol: TCP
          port: 8087
        - protocol: TCP
          port: 3006
        - protocol: TCP
          port: 80
    - to:
        - ipBlock:
            cidr: 0.0.0.0/0
            except:
              - 10.0.0.0/8
              - 172.16.0.0/12
              - 192.168.0.0/16
      ports:
        - protocol: TCP
          port: 443
        - protocol: TCP
          port: 5432
        - protocol: TCP
          port: 6380
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: postgresql
      ports:
        - protocol: TCP
          port: 5432
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: redis
      ports:
        - protocol: TCP
          port: 6379

---
# Worker: Video Processor
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: video-processor-network-policy
  namespace: nexus
  labels:
    app.kubernetes.io/name: video-processor
    app.kubernetes.io/part-of: nexus-platform
spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/name: video-processor
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: monitoring
      ports:
        - protocol: TCP
          port: 9090
  egress:
    - to:
        - namespaceSelector: {}
          podSelector:
            matchLabels:
              k8s-app: kube-dns
      ports:
        - protocol: UDP
          port: 53
        - protocol: TCP
          port: 53
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: content-service
      ports:
        - protocol: TCP
          port: 8087
        - protocol: TCP
          port: 3006
        - protocol: TCP
          port: 80
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: asset-service
      ports:
        - protocol: TCP
          port: 8088
        - protocol: TCP
          port: 80
    - to:
        - ipBlock:
            cidr: 0.0.0.0/0
            except:
              - 10.0.0.0/8
              - 172.16.0.0/12
              - 192.168.0.0/16
      ports:
        - protocol: TCP
          port: 443
        - protocol: TCP
          port: 6380
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: redis
      ports:
        - protocol: TCP
          port: 6379

---
# Worker: Social Publisher
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: social-publisher-network-policy
  namespace: nexus
  labels:
    app.kubernetes.io/name: social-publisher
    app.kubernetes.io/part-of: nexus-platform
spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/name: social-publisher
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: monitoring
      ports:
        - protocol: TCP
          port: 9090
  egress:
    - to:
        - namespaceSelector: {}
          podSelector:
            matchLabels:
              k8s-app: kube-dns
      ports:
        - protocol: UDP
          port: 53
        - protocol: TCP
          port: 53
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: integration-service
      ports:
        - protocol: TCP
          port: 8095
        - protocol: TCP
          port: 80
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: content-service
      ports:
        - protocol: TCP
          port: 8087
        - protocol: TCP
          port: 3006
        - protocol: TCP
          port: 80
    - to:
        - ipBlock:
            cidr: 0.0.0.0/0
            except:
              - 10.0.0.0/8
              - 172.16.0.0/12
              - 192.168.0.0/16
      ports:
        - protocol: TCP
          port: 443
        - protocol: TCP
          port: 6380
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: redis
      ports:
        - protocol: TCP
          port: 6379

---
# Worker: Analytics Aggregator
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: analytics-aggregator-network-policy
  namespace: nexus
  labels:
    app.kubernetes.io/name: analytics-aggregator
    app.kubernetes.io/part-of: nexus-platform
spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/name: analytics-aggregator
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: monitoring
      ports:
        - protocol: TCP
          port: 9090
  egress:
    - to:
        - namespaceSelector: {}
          podSelector:
            matchLabels:
              k8s-app: kube-dns
      ports:
        - protocol: UDP
          port: 53
        - protocol: TCP
          port: 53
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: analytics-service
      ports:
        - protocol: TCP
          port: 8090
        - protocol: TCP
          port: 3007
        - protocol: TCP
          port: 80
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: postgresql
      ports:
        - protocol: TCP
          port: 5432
    - to:
        - ipBlock:
            cidr: 0.0.0.0/0
            except:
              - 10.0.0.0/8
              - 172.16.0.0/12
              - 192.168.0.0/16
      ports:
        - protocol: TCP
          port: 5432
        - protocol: TCP
          port: 443
        - protocol: TCP
          port: 6380
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: redis
      ports:
        - protocol: TCP
          port: 6379

---
# Worker: Notification Dispatcher
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: notification-dispatcher-network-policy
  namespace: nexus
  labels:
    app.kubernetes.io/name: notification-dispatcher
    app.kubernetes.io/part-of: nexus-platform
spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/name: notification-dispatcher
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: monitoring
      ports:
        - protocol: TCP
          port: 9090
  egress:
    - to:
        - namespaceSelector: {}
          podSelector:
            matchLabels:
              k8s-app: kube-dns
      ports:
        - protocol: UDP
          port: 53
        - protocol: TCP
          port: 53
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: notification-service
      ports:
        - protocol: TCP
          port: 8084
        - protocol: TCP
          port: 3004
        - protocol: TCP
          port: 80
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: user-service
      ports:
        - protocol: TCP
          port: 8082
        - protocol: TCP
          port: 3002
        - protocol: TCP
          port: 80
    - to:
        - ipBlock:
            cidr: 0.0.0.0/0
            except:
              - 10.0.0.0/8
              - 172.16.0.0/12
              - 192.168.0.0/16
      ports:
        - protocol: TCP
          port: 443
        - protocol: TCP
          port: 587
        - protocol: TCP
          port: 465
        - protocol: TCP
          port: 6380
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: redis
      ports:
        - protocol: TCP
          port: 6379
